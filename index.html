<!DOCTYPE html>
<html>
<head>
    <title>Millitron Quality</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: Arial;
            margin: 20px;
        }
        .section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #cccccc;
            border-radius: 8px;
        }
        .photo-preview {
            max-width: 140px;
            max-height: 140px;
            margin: 6px;
            border: 1px solid #aaa;
            border-radius: 6px;
        }
        #photoPreviewContainer {
            display: flex;
            flex-wrap: wrap;
        }
        .button {
            padding: 10px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 6px;
        }
        .button:hover {
            opacity: 0.85;
        }
        .top-right {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>

</head>
<body>

<!-- USER MANAGEMENT BUTTON (unchanged, original position) -->
<button class="button top-right" onclick="showLogin()">User Management</button>

<h1>Millitron Quality</h1>

<!-- LOGIN PAGE -->
<div id="loginPage" class="section" style="display:none;">
    <h2>Login</h2>
    <label>Username:</label><br>
    <input id="loginUser" /><br><br>

    <label>Password:</label><br>
    <input id="loginPass" type="password" /><br><br>

    <button class="button" onclick="login()">Login</button>
</div>

<!-- MAIN APP -->
<div id="mainApp">

    <!-- ADD ENTRY -->
    <div class="section">
        <h2>Add Production Entry</h2>

        <label>Date:</label><br>
        <input id="entryDate" type="date"><br><br>

        <label>Operator:</label><br>
        <input id="entryOperator"><br><br>

        <label>Comments:</label><br>
        <textarea id="entryComments" rows="3"></textarea><br><br>

        <label>Photos (preview only, not saved):</label><br>
        <button class="button" onclick="pickPhoto()">Upload Photo</button>
        <input id="photoInput" type="file" accept="image/*" style="display:none;">
        <div id="photoPreviewContainer"></div>

        <br>

        <button class="button" onclick="saveEntry()">Save Entry</button>
    </div>

    <!-- SEARCH ENTRIES -->
    <div class="section">
        <h2>Search Records</h2>

        <input id="searchBox" placeholder="Search by operator or comments" oninput="searchEntries()"><br><br>

        <div id="searchResults"></div>
    </div>

</div>

<script>
/* ---------- PHOTO PREVIEW (still works, not saved) ---------- */
document.getElementById("photoInput").addEventListener("change", function () {
    const container = document.getElementById("photoPreviewContainer");
    container.innerHTML = "";

    for (const file of this.files) {
        const reader = new FileReader();
        reader.onload = function (e) {
            let img = document.createElement("img");
            img.src = e.target.result;
            img.className = "photo-preview";
            container.appendChild(img);
        };
        reader.readAsDataURL(file);
    }
});

function pickPhoto() {
    document.getElementById("photoInput").click();
}

/* ---------- SAVE ENTRY (NO PHOTOS SAVED) ---------- */
function saveEntry() {
    try {
        const date = document.getElementById("entryDate").value;
        const operator = document.getElementById("entryOperator").value;
        const comments = document.getElementById("entryComments").value;

        if (!date || !operator || !comments) {
            alert("All fields must be filled.");
            return;
        }

        const entry = {
            id: Date.now(),
            date: date,
            operator: operator,
            comments: comments
            // Photos removed from storage completely
        };

        let data = JSON.parse(localStorage.getItem("millitron_entries") || "[]");
        data.push(entry);
        localStorage.setItem("millitron_entries", JSON.stringify(data));

        // Clear form
        document.getElementById("entryDate").value = "";
        document.getElementById("entryOperator").value = "";
        document.getElementById("entryComments").value = "";
        document.getElementById("photoPreviewContainer").innerHTML = "";
        document.getElementById("photoInput").value = "";

        alert("Entry saved successfully.");

        searchEntries();

    } catch (err) {
        alert("Save failed: " + err);
    }
}

/* ---------- SEARCH & DELETE ENTRIES ---------- */
function searchEntries() {
    const search = document.getElementById("searchBox").value.toLowerCase();
    const resultsDiv = document.getElementById("searchResults");
    resultsDiv.innerHTML = "";

    let data = JSON.parse(localStorage.getItem("millitron_entries") || "[]");

    let filtered = data.filter(entry =>
        entry.operator.toLowerCase().includes(search) ||
        entry.comments.toLowerCase().includes(search)
    );

    filtered.forEach(entry => {
        let box = document.createElement("div");
        box.style.border = "1px solid #999";
        box.style.padding = "10px";
        box.style.marginBottom = "10px";
        box.style.borderRadius = "6px";

        box.innerHTML =
            "<b>Date:</b> " + entry.date + "<br>" +
            "<b>Operator:</b> " + entry.operator + "<br>" +
            "<b>Comments:</b> " + entry.comments + "<br><br>" +
            `<button class='button' onclick='deleteEntry(${entry.id})'>Delete</button>`;

        resultsDiv.appendChild(box);
    });
}

function deleteEntry(id) {
    let data = JSON.parse(localStorage.getItem("millitron_entries") || "[]");
    data = data.filter(e => e.id !== id);
    localStorage.setItem("millitron_entries", JSON.stringify(data));
    searchEntries();
}

/* ---------- LOGIN SYSTEM (unchanged, now working) ---------- */
function showLogin() {
    document.getElementById("loginPage").style.display = "block";
}

function login() {
    const user = document.getElementById("loginUser").value;
    const pass = document.getElementById("loginPass").value;

    if (user === "admin" && pass === "1234") {
        document.getElementById("loginPage").style.display = "none";
        alert("Logged in.");
    } else {
        alert("Incorrect login.");
    }
}
</script>

</body>
</html>
