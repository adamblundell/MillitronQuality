
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Millitron Quality</title>
<style>
  body { font-family: sans-serif; margin:0; padding:20px; background-color:#f5f5f5; }
  h1,h2 { text-align:center; }
  input, button { font-size: 18px; padding:10px; margin:5px; width:90%; max-width:300px; }
  button { cursor:pointer; }
  .center { display:flex; justify-content:center; align-items:center; flex-direction:column; }
  .row { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin:10px 0; }
  .photos { display:flex; flex-wrap:wrap; gap:10px; margin:10px 0; justify-content:center; }
  .photos img { max-width:120px; cursor:pointer; border:1px solid #ccc; }
  .record { border:1px solid #ccc; padding:10px; margin:10px auto; width:90%; max-width:500px; }
  .list-entry { display:flex; flex-direction:column; align-items:center; margin-bottom:15px; }
  .hidden { display:none; }
</style>
</head>
<body>

<!-- Login Page -->
<div id="loginPage" class="center">
  <h1>Millitron Quality Login</h1>
  <input type="text" id="loginUser" placeholder="Username">
  <input type="password" id="loginPass" placeholder="Password">
  <button id="loginBtn">Login</button>
</div>

<!-- Homepage -->
<div id="homePage" class="center hidden">
  <h1>Millitron Quality Homepage</h1>
  <div class="row">
    <button id="addEntryBtn">Add Production Entry</button>
    <button id="searchBtn">Search Records</button>
  </div>
  <div>Logged in as: <span id="currentUserDisplay"></span></div>
  <button id="logoutBtn">Logout</button>
</div>

<!-- Add Entry Page -->
<div id="addEntryPage" class="center hidden">
  <h2>Add Production Entry</h2>
  <div class="list-entry"><label>Production Order:</label><input type="text" id="prodOrder"></div>
  <div class="list-entry"><label>DR Number:</label><input type="text" id="drNumber"></div>
  <div class="list-entry"><label>Date:</label><input type="date" id="date"></div>
  <div class="list-entry">
    <label>Photos:</label>
    <input type="file" id="photo1" accept="image/*" capture="environment">
    <input type="file" id="photo2" accept="image/*" capture="environment">
    <input type="file" id="photo3" accept="image/*" capture="environment">
    <div class="photos" id="photoPreview"></div>
  </div>
  <div class="row">
    <button id="saveEntryBtn">Save Entry</button>
    <button id="backFromAdd">Back</button>
  </div>
</div>

<!-- Search Page -->
<div id="searchPage" class="center hidden">
  <h2>Search Records</h2>
  <input type="text" id="searchInput" placeholder="Prod Order, DR, or Date">
  <button id="searchRecordsBtn">Search</button>
  <div id="records"></div>
  <button id="backFromSearch">Back</button>
</div>

<script>
// -------- Utility Functions ----------
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    if(!file) resolve(null);
    const reader=new FileReader();
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = err => reject(err);
    reader.readAsDataURL(file);
  });
}

function loadRecords(){ return JSON.parse(localStorage.getItem('prodRecords')||'[]'); }
function saveRecords(records){ localStorage.setItem('prodRecords', JSON.stringify(records)); }

// -------- Page Navigation ----------
function hideAll(){ ['loginPage','homePage','addEntryPage','searchPage'].forEach(id=>document.getElementById(id).classList.add('hidden')); }
function showHome(){ hideAll(); document.getElementById('homePage').classList.remove('hidden'); }
function showAddEntry(){ hideAll(); document.getElementById('addEntryPage').classList.remove('hidden'); }
function showSearch(){ hideAll(); document.getElementById('searchPage').classList.remove('hidden'); }
function backToHome(){ document.getElementById('searchInput').value=''; document.getElementById('records').innerHTML=''; showHome(); }

// -------- User System ----------
let users = JSON.parse(localStorage.getItem('users') || '[]');
if(users.length === 0){ users.push({username:'admin', password:'admin'}); localStorage.setItem('users', JSON.stringify(users)); }

function login(){
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  const found = users.find(x=>x.username===u && x.password===p);
  if(found){
    localStorage.setItem('currentUser', u);
    document.getElementById('currentUserDisplay').textContent = u;
    showHome();
  } else alert('Invalid credentials');
}

function logout(){
  localStorage.removeItem('currentUser');
  document.getElementById('loginUser').value='';
  document.getElementById('loginPass').value='';
  hideAll();
  document.getElementById('loginPage').classList.remove('hidden');
}

// -------- Entry & Photos ----------
document.addEventListener('DOMContentLoaded', function(){

  const previewDiv = document.getElementById('photoPreview');

  // Photo preview
  ['photo1','photo2','photo3'].forEach(id=>{
    document.getElementById(id).addEventListener('change', e=>{
      const file = e.target.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = ev=>{
          const img = document.createElement('img');
          img.src = ev.target.result;
          previewDiv.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    });
  });

  // Save Entry
  document.getElementById('saveEntryBtn').addEventListener('click', async ()=>{
    const prodOrder = document.getElementById('prodOrder').value.trim();
    const drNumber = document.getElementById('drNumber').value.trim();
    const date = document.getElementById('date').value;
    const currentUser = localStorage.getItem('currentUser') || 'Unknown';

    if(!prodOrder || !drNumber || !date){ alert('Fill all fields'); return; }

    const files = [document.getElementById('photo1').files[0], document.getElementById('photo2').files[0], document.getElementById('photo3').files[0]];
    const photos = [];
    for(const f of files){ photos.push(await fileToBase64(f)); }

    const records = loadRecords();
    records.push({prodOrder, drNumber, date, user:currentUser, photos});
    saveRecords(records);

    alert('Entry saved!');
    ['prodOrder','drNumber','date','photo1','photo2','photo3'].forEach(id => document.getElementById(id).value='');
    previewDiv.innerHTML='';
  });

  // Search Records
  function displayRecords(filter=''){
    const container = document.getElementById('records');
    container.innerHTML='';
    loadRecords().filter(r=>{
      if(!filter) return true;
      return r.prodOrder.includes(filter) || r.drNumber.includes(filter) || r.date.includes(filter);
    }).forEach((r,idx)=>{
      const div = document.createElement('div');
      div.className = 'record';
      div.innerHTML = `<strong>Prod Order:</strong> ${r.prodOrder}<br>
                       <strong>DR Number:</strong> ${r.drNumber}<br>
                       <strong>Date:</strong> ${r.date}<br>
                       <strong>User:</strong> ${r.user}<br>`;
      container.appendChild(div);
    });
  }

  document.getElementById('searchRecordsBtn').addEventListener('click', ()=>{
    const filter = document.getElementById('searchInput').value.trim();
    displayRecords(filter);
  });

  // Buttons navigation
  document.getElementById('loginBtn').addEventListener('click', login);
  document.getElementById('logoutBtn').addEventListener('click', logout);
  document.getElementById('addEntryBtn').addEventListener('click', showAddEntry);
  document.getElementById('searchBtn').addEventListener('click', showSearch);
  document.getElementById('backFromAdd').addEventListener('click', backToHome);
  document.getElementById('backFromSearch').addEventListener('click', backToHome);

});

// -------- On Load ----------
hideAll();
document.getElementById('loginPage').classList.remove('hidden');
</script>

</body>
</html>
