document.getElementById('saveEntryBtn').addEventListener('click', async () => {
  try {
    const prodOrder = document.getElementById('prodOrder').value.trim();
    const drNumber = document.getElementById('drNumber').value.trim();
    const date = document.getElementById('date').value;
    const currentUser = localStorage.getItem('currentUser') || 'Unknown';

    if (!prodOrder || !drNumber || !date) { 
      alert('Fill all fields'); 
      return; 
    }

    const files = [
      document.getElementById('photo1').files[0],
      document.getElementById('photo2').files[0],
      document.getElementById('photo3').files[0]
    ];

    const photos = [];
    for (const f of files) {
      // Use the resize function here
      photos.push(await resizeImage(f)); 
    }

    const records = loadRecords();
    records.push({ prodOrder, drNumber, date, user: currentUser, photos });
    saveRecords(records);

    alert('Entry saved!');
    ['prodOrder', 'drNumber', 'date', 'photo1', 'photo2', 'photo3'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('photoPreview').innerHTML = '';

  } catch (err) {
    alert('Failed to save entry: ' + err.message);
    console.error(err); // also log for debugging
  }
});
